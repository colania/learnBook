# 一条SQL查询语句是如何执行的



## MySQL 内部的执行过程

<img src="https://static001.geekbang.org/resource/image/0d/d9/0d2070e8f84c4801adbfa03bda1f98d9.png" alt="MySQL 的逻辑架构图" style="zoom:20%;" />

Mysql分为server层和存储引擎层。

Server 层包括连接器、查询缓存、分析器、优化器、执行器等，存储引擎层

存储引擎层负责数据的存储和提取。其架构模式是插件式的。

### 连接器

连接器负责跟客户端建立连接、获取权限、维持和管理连接。连接后验证身份。

* 如果用户名密码认证通过，连接器会到权限表里面查出你拥有的权限。之后，这个连接里面的权限判断逻辑，都将依赖于 _此时_ 读到的权限。

### 查询缓存

之前执行过的语句及其结果可能会以 key-value 对的形式，被直接缓存在内存中。MySQL 8.0 版本直接将查询缓存的整块功能删掉了。



### 分析器

词法分析 --> 语法分析 



### 优化器

优化器是在表里面有多个索引的时候，决定**使用哪个索引**；或者在一个语句有多表关联（join）的时候，决定各个表的**连接顺序**。



### 执行器

* 判断用户权限
* 调用存储引擎接口

